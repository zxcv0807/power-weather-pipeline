# 네트워크 진단 방법

1. 일반 인터넷 연결 확인
- 구글 DNS서버에 신호를 보낸다.
```bash
ping -c 4 8.8.8.8
```
- 성공: 응답 시간(time=...ms)이 계속 뜬다.
- 실패: 아무 반응이 없거나 unreachable이 뜬다.

2. API 서버 접속 확인 (CURL)

- 공공데이터포털 확인
```bash
curl -v http://apis.data.go.kr
```
Connected to ... 메시지와 500 Internal Server Error가 떴다.
에러는 떴지만, 네트워크 연결 자체는 성공한 것이다.

- 전력거래소 확인
```bash
curl -v https://openapi.kpx.or.kr
```
Trying 211.179.209.205:443... 에서 멈춘다.

## 전력거래소 네트워크 진단

전력 거래소 방화벽이 AWS 클라우드의 IP 대역을 차단하고 있다.

- TCP 경로 추적 (Traceroute)
1. traceroute 도구 설치
```bash
sudo apt-get install -y traceroute
```
3. 전력거래소 443 포트로 가는 경로 추적
```bash
sudo traceroute -T -p 443 openapi.kpx.or.kr
```
4. 결과
```bash
traceroute to openapi.kpx.or.kr (211.179.209.205), 30 hops max, 60 byte packets
1  240.3.32.12 (240.3.32.12)  2.142 ms 240.3.32.14 (240.3.32.14)  2.329 ms 240.3.32.13 (240.3.32.13)  2.143 ms
2  242.7.196.133 (242.7.196.133)  2.030 ms 242.7.197.133 (242.7.197.133)  2.023 ms 242.7.197.7 (242.7.197.7)  1.899 ms
3  211.116.61.90 (211.116.61.90)  2.807 ms 54.239.121.174 (54.239.121.174)  2.591 ms *
4  * * *
5  * 1.213.107.145 (1.213.107.145)  2.372 ms *
6  * * *
7  1.213.90.6 (1.213.90.6)  7.714 ms 1.213.90.10 (1.213.90.10)  7.396 ms 1.208.90.6 (1.208.90.6)  7.158 ms
8  211.170.34.210 (211.170.34.210)  10.247 ms  10.387 ms  10.252 ms
9  211.179.209.7 (211.179.209.7)  9.593 ms  9.458 ms  9.411 ms
10  * * *
11  * * *
12  * * *
...
30  * * *
```
Hop 1~9는 정상적으로 패킷이 이동했지만, 10부터 패킷이 실종되었다. TCP SYN Drop 현상으로써, 패킷을 계속 Drop하는 것이다.

- 탄력적 IP 할당을 통해 AWS 대역 차단 확인
EC2 인스턴스에 새로운 탄력적 IP를 할당하여 내IP가 차단된 것인지, 아니면 AWS 대역을 차단하고 있는것인지 확인한다.

=> 탄력적 IP할당을 함에도 불구하고 계속해서 TCP SYN Drop 현상이 나타나는 것을 보아 AWS 대역을 차단하고 있다. 그래서 AWS 클라우드만 사용하는 것이 아닌 국내 클라우드 서비스인 네이버 클라우드 서비스를 통해 운영환경을 갖추게 되었다.
(보수적인 공공기관이나 금융권은 보안 정책상 "해외 클라우드 대역(AWS, GCP, Azure, Oracle 등)"의 접근을 통쨰로 막아놓는 경우가 많다.)